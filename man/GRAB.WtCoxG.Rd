% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/WtCoxG.R
\name{GRAB.WtCoxG}
\alias{GRAB.WtCoxG}
\title{Weighted Cox regression for genetic association analysis with case ascertainment}
\usage{
GRAB.WtCoxG()
}
\value{
No return value. Called for informational side effects.
}
\description{
WtCoxG provides an accurate, powerful, and computationally efficient Cox-based
approach for genome-wide time-to-event analyses in study cohorts with case
ascertainment.
}
\details{
\strong{Two-Step Analysis Process:}
\enumerate{
\item \strong{Step 1}: Fit null model and test for batch effects using sample SNPs
\item \strong{Step 2}: Conduct GWAS with allele frequencies of a reference sample
}

\strong{Additional Parameters for \code{GRAB.NullModel()}:}
\itemize{
\item \code{RefAfFile} (character, required): Reference allele frequency file path.
File must contain columns: CHROM, POS, ID, REF, ALT, AF_ref, AN_ref
\item \code{SurvTimeColumn} (character, default: "SurvTime"): Column name in
\code{data} containing survival times
\item \code{IndicatorColumn} (character, default: "Indicator"): Column name in
\code{data} for case-control status (0 = control, 1 = case)
}

\strong{Additional Control Parameters for GRAB.NullModel()}:
\itemize{
\item \code{RefPrevalence} (numeric, required): Population-level disease prevalence
for weighting. Must be in range (0, 0.5)
\item \code{OutlierRatio} (numeric, default: 1.5): IQR multiplier for outlier detection
\item \code{SNPnum} (numeric, default: 1e4): Minimum number of SNPs for batch effect testing
}

\strong{Additional Control Parameters for GRAB.Marker()}:
\itemize{
\item \code{cutoff} (numeric, default: 0.1): Cutoff of batch effect test p-value for
association testing. Variants with batch effect p-value below this cutoff
will be excluded from association testing.
}
}
\examples{
# Step0&1: fit a null model and estimate parameters according to batch effect p-values
PhenoFile <- system.file("extdata", "simuPHENO.txt", package = "GRAB")
PhenoData <- data.table::fread(PhenoFile, header = TRUE)
SparseGRMFile <- system.file("extdata", "SparseGRM.txt", package = "GRAB")

GenoFile <- system.file("extdata", "simuPLINK.bed", package = "GRAB")
RefAfFile <- system.file("extdata", "simuRefAf.txt", package = "GRAB")
RefPrevalence <- 0.1 # population-level disease prevalence

OutputDir <- tempdir()
OutputFile <- file.path(OutputDir, "WtCoxG_step2_out.txt")

obj.WtCoxG <- GRAB.NullModel(
  formula = survival::Surv(SurvTime, SurvEvent) ~ AGE + GENDER,
  data = PhenoData,
  subjIDcol = "IID",
  method = "WtCoxG",
  traitType = "time-to-event",
  GenoFile = GenoFile,
  SparseGRMFile = SparseGRMFile,
  control = list(
    AlleleOrder = "ref-first",
    AllMarkers = TRUE,
    RefPrevalence = RefPrevalence,
    SNPnum = 1000
  ),
  RefAfFile = RefAfFile,
  SurvTimeColumn = "SurvTime",
  IndicatorColumn = "SurvEvent"
)

obj.WtCoxG$mergeGenoInfo[, c("CHROM", "POS", "pvalue_bat")]

# Step2: conduct association testing
OutputFile <- file.path(tempdir(), "resultWtCoxG.txt")
GRAB.Marker(obj.WtCoxG, GenoFile, OutputFile,
  control = list(
    AlleleOrder = "ref-first",
    AllMarkers = TRUE,
    cutoff = 0.1,
    nMarkersEachChunk = 5000
  )
)

data.table::fread(OutputFile)[, c("CHROM", "POS", "WtCoxG.noext", "WtCoxG.ext")]

}
