% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/WtCoxG.R
\name{GRAB.WtCoxG}
\alias{GRAB.WtCoxG}
\title{Weighted Cox regression for genetic association analysis with case ascertainment}
\usage{
GRAB.WtCoxG()
}
\value{
No return value. Called for informational side effects.
}
\description{
WtCoxG provides an accurate, powerful, and computationally efficient Cox-based
approach for genome-wide time-to-event analyses in study cohorts with case
ascertainment.
}
\details{
\strong{Two-Step Analysis Process:}
\enumerate{
\item \strong{Step 1}: Fit null model and test for batch effects using sample SNPs
\item \strong{Step 2}: Conduct genome-wide association testing with bias correction
}

\strong{Required Additional Arguments for \code{GRAB.NullModel()}:}
\itemize{
\item \code{RefAfFile}: Reference allele frequency file (CSV format) with
columns: CHROM, POS, ID, REF, ALT, AF_ref, AN_ref
\item \code{OutputFile}: Output file path for Step 1 results
\item \code{SampleIDColumn}: Column name containing sample IDs
\item \code{SurvTimeColumn}: Column name containing survival times
\item \code{IndicatorColumn}: Column name for case-control status (0/1)
}

\strong{Required Control Parameters for \code{GRAB.NullModel()}:}
\itemize{
\item \code{RefPrevalence}: Population-level disease prevalence for weighting
\item \code{SNPnum}: Minimum number of SNPs for batch effect testing (default: 1e4)
}

\strong{Control Parameters for \code{GRAB.Marker()}:}
\itemize{
\item \code{cutoff}: P-value threshold for batch effect test method selection (default: 0.1)
}
}
\examples{
# Step0&1: fit a null model and estimate parameters according to batch effect p-values
PhenoFile <- system.file("extdata", "simuPHENO.txt", package = "GRAB")
PhenoData <- data.table::fread(PhenoFile, header = TRUE)
SparseGRMFile <- system.file("extdata", "SparseGRM.txt", package = "GRAB")

GenoFile <- system.file("extdata", "simuPLINK.bed", package = "GRAB")
RefAfFile <- system.file("extdata", "simuRefAf.txt", package = "GRAB")
RefPrevalence <- 0.1 # population-level disease prevalence

OutputDir <- tempdir()
OutputStep1 <- file.path(OutputDir, "WtCoxG_step1_out.txt")
OutputStep2 <- file.path(OutputDir, "WtCoxG_step2_out.txt")

obj.WtCoxG <- GRAB.NullModel(
  formula = survival::Surv(SurvTime, SurvEvent) ~ AGE + GENDER,
  data = PhenoData,
  subjData = PhenoData$IID,
  method = "WtCoxG",
  traitType = "time-to-event",
  GenoFile = GenoFile,
  SparseGRMFile = SparseGRMFile,
  control = list(
    AlleleOrder = "ref-first",
    AllMarkers = TRUE,
    RefPrevalence = RefPrevalence,
    SNPnum = 1000
  ),
  RefAfFile = RefAfFile,
  OutputFile = OutputStep1,
  SampleIDColumn = "IID",
  SurvTimeColumn = "SurvTime",
  IndicatorColumn = "SurvEvent"
)

resultStep1 <- data.table::fread(OutputStep1)
resultStep1[, c("CHROM", "POS", "pvalue_bat")]

# Step2: conduct association testing
GRAB.Marker(
  objNull = obj.WtCoxG,
  GenoFile = GenoFile,
  OutputFile = OutputStep2,
  control = list(
    AlleleOrder = "ref-first",
    AllMarkers = TRUE,
    cutoff = 0.1,
    nMarkersEachChunk = 5000
  )
)

resultStep2 <- data.table::fread(OutputStep2)
resultStep2[, c("CHROM", "POS", "WtCoxG.noext", "WtCoxG.ext")]

}
