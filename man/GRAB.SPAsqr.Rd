% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/GRAB_SPAsqr.R
\name{GRAB.SPAsqr}
\alias{GRAB.SPAsqr}
\title{Instruction of SPAsqr method}
\usage{
GRAB.SPAsqr()
}
\description{
SPAsqr is a smoothed quantile regression-based association test method for
quantitative traits. It accounts for sample relatedness using the SPAGRM framework,
performs association testing across multiple quantiles, and combines p-values
using the Cauchy combination test.
}
\details{
\strong{Additional Control Parameters for \code{GRAB.NullModel()}:}
\itemize{
\item \code{taus} (numeric vector, default: c(0.05, 0.2, 0.5, 0.8, 0.95)): Quantiles
to examine for association testing. All values must be between 0 and 1. P-values
across quantiles are combined using Cauchy combination test.
\item \code{h} (numeric, default: 0): Bandwidth parameter for smooth quantile regression.
If h = 0, bandwidth is automatically selected as IQR(y)/3.
\item \code{frqFile} (character, default: NULL): Path to allele frequency file. If NULL,
uses PlinkPrefix.frq for pairwise IBD calculation.
\item \code{tempDir} (character, default: NULL): Directory for temporary files during
pairwise IBD calculation. If NULL, uses tempdir().
\item \code{maxSampleNums} (integer, default: 2500): Maximum number of subjects' genotypes
to read for pairwise IBD analysis.
\item \code{minMafIBD} (numeric, default: 0.01): Minimum MAF cutoff to select markers
for pairwise IBD calculation.
\item \code{rm.tempFile} (logical, default: FALSE): Whether to delete temporary files
after pairwise IBD calculation.
\item \code{MaxQuantile} (numeric, default: 0.75): Upper quantile for outlier detection.
Must be greater than MinQuantile.
\item \code{MinQuantile} (numeric, default: 0.25): Lower quantile for outlier detection.
Must be less than MaxQuantile.
\item \code{OutlierRatio} (numeric, default: 1.5): IQR multiplier for outlier cutoff
calculation. Must be greater than 0.
\item \code{ControlOutlier} (logical, default: TRUE): Whether to automatically adjust
outlier ratio to keep outliers below 5\\% of sample size.
\item \code{MaxNuminFam} (integer, default: 5): Maximum family size for Chow-Liu tree
construction in related samples.
\item \code{MAF_interval} (numeric vector, default: c(0.0001, 0.0005, 0.001, 0.005,
0.01, 0.05, 0.1, 0.2, 0.3, 0.4, 0.5)): MAF breakpoints for genotype distribution
approximation in families.
\item \code{sqr_tol} (numeric, default: 1e-7): Tolerance level for convergence in SQR fitting.
}

\strong{Method-specific elements in the \code{SPAsqr_NULL_Model} object returned by \code{GRAB.NullModel()}:}
\itemize{
\item All elements from \code{SPAGRM_NULL_Model} (see \code{\link{SPAGRM.NullModel}}).
\item \code{Resid}: Numeric vector (or matrix for multiple quantiles) of residuals from
quantile regression model.
\item \code{subjData}: Character vector of subject IDs.
\item \code{N}: Number of subjects in analysis.
}

\strong{Output file columns}:
\describe{
\item{Marker}{Marker identifier (rsID or CHR:POS:REF:ALT).}
\item{Info}{Marker information in format CHR:POS:REF:ALT.}
\item{AltFreq}{Alternative allele frequency in the sample.}
\item{AltCounts}{Total count of alternative alleles.}
\item{MissingRate}{Proportion of missing genotypes.}
\item{zScore}{Z-score from the score test.}
\item{Pvalue}{P-value from the score test (Cauchy combined across quantiles).}
\item{hwepval}{Hardy-Weinberg equilibrium p-value.}
}
}
\examples{
# Step 1: fit null model and calculate joint distribution of genotypes
PhenoFile <- system.file("extdata", "simuPHENO.txt", package = "GRAB")
PhenoData <- data.table::fread(PhenoFile, header = TRUE)
SparseGRMFile <- system.file("extdata", "SparseGRM.txt", package = "GRAB")
GenoFile <- system.file("extdata", "simuPLINK.bed", package = "GRAB")
OutputFile <- file.path(tempdir(), "resultSPAsqr.txt")

obj.SPAsqr <- GRAB.NullModel(
  QuantPheno ~ AGE + GENDER,
  data = PhenoData,
  subjIDcol = "IID",
  method = "SPAsqr",
  traitType = "quantitative",
  GenoFile = GenoFile,
  SparseGRMFile = SparseGRMFile,
  control = list(
    taus = c(0.05, 0.2, 0.5, 0.8, 0.95),
    h = 0
  )
)

# Step 2: perform association tests
GRAB.Marker(obj.SPAsqr, GenoFile, OutputFile)

head(data.table::fread(OutputFile))

}
\references{
Xu et al. (2025). SPAGRM: effectively controlling for sample relatedness in large-scale
genome-wide association studies of longitudinal traits. Nature Communications, 16:1018.

Liu, Yaowu and Jun Xie (2020). Cauchy combination test: a powerful test with analytic p-value
calculation under arbitrary dependency structures. Journal of the American Statistical
Association, 115.529:393-402.
}
