% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/GRAB_SPAsqr.R
\name{GRAB.SPAsqr}
\alias{GRAB.SPAsqr}
\title{Instructions for SPAsqr method (Smoothed Quantile Regression with Saddlepoint Approximation)}
\usage{
GRAB.SPAsqr()
}
\description{
SPAsqr is a smoothed quantile regression-based association test method for
quantitative traits. It accounts for sample relatedness using the SPAGRM framework,
performs association testing across multiple quantiles, and combines p-values
using the Cauchy combination test (CCT).
}
\details{
\strong{Usage with \code{GRAB.NullModel()}:}

Set \code{method = "SPAsqr"} and \code{traitType = "quantitative"}. Two additional required arguments:
\itemize{
\item \code{SparseGRMFile}: Path to sparse GRM file (whitespace-delimited: ID1 ID2 Value).
\item \code{PairwiseIBDFile}: Path to pairwise IBD file (see \code{?\link{getPairwiseIBD}}).
}

\strong{Control parameters for \code{GRAB.NullModel(control = list(...))}:}
\itemize{
\item \code{taus} (numeric vector, default: c(0.05, 0.2, 0.5, 0.8, 0.95)): Quantiles
to examine for association testing. All values must be between 0 and 1 (exclusive).
P-values across quantiles are combined using Cauchy combination test.
\item \code{smooth} (logical, default: TRUE): Whether to use smoothed quantile regression.
If FALSE, nonsmooth quantile regression is used; \code{h} and \code{sqr_tol} are ignored.
\item \code{h} (numeric, default: 0): Bandwidth parameter for smooth quantile regression.
If h = 0, bandwidth is automatically selected as IQR(y)/3.
\item \code{MaxNuminFam} (integer, default: 5): Maximum family size for Chow-Liu tree
construction in related samples. Larger families are decomposed into smaller components.
\item \code{MAF_interval} (numeric vector, default: c(0.0001, 0.0005, 0.001, 0.005,
0.01, 0.05, 0.1, 0.2, 0.3, 0.4, 0.5)): MAF breakpoints for genotype distribution
approximation in families.
\item \code{sqr_tol} (numeric, default: 1e-7): Tolerance level for convergence in smoothed quantile regression fitting.
}

\strong{Control parameters for \code{GRAB.Marker(control = list(...))}:}
\itemize{
\item \code{SPA_Cutoff} (numeric, default: 2): Z-score cutoff for applying saddlepoint approximation.
\item \code{zeta} (numeric, default: 0): SPA moment approximation parameter.
\item \code{tol} (numeric, default: 1e-5): Numerical tolerance for SPA calculations.
\item See \code{?\link{GRAB.Marker}} for additional quality control parameters (MAF, MAC, missing rate).
}

\strong{Elements in the \code{SPAsqr_NULL_Model} object returned by \code{GRAB.NullModel()}:}
\itemize{
\item \code{taus}: Numeric vector of quantiles analyzed.
\item \code{Resid_mat}: Numeric matrix of residuals from smoothed quantile regression (N Ã— ntaus).
\item \code{subjData}: Character vector of subject IDs included in analysis.
\item \code{N}: Number of subjects in analysis (integer).
\item \code{R_GRM_R_vec}: Numeric vector of R'\emph{GRM}R values for each quantile (length ntaus).
\item \code{R_GRM_R_TwoSubjOutlier_vec}: Numeric vector of R'\emph{GRM}R contributions from two-subject outlier pairs (length ntaus).
\item \code{sum_R_nonOutlier_vec}: Numeric vector of summed residuals for non-outlier subjects (length ntaus).
\item \code{R_GRM_R_nonOutlier_vec}: Numeric vector of R'\emph{GRM}R contributions from non-outlier subjects (length ntaus).
\item \code{Resid.unrelated.outliers_lst}: List of residual vectors for unrelated outliers (ntaus elements).
\item \code{TwoSubj_list_lst}: List of two-subject outlier family information (ntaus elements).
\item \code{CLT_union_lst}: List of Chow-Liu tree structures for related families (shared across all quantiles).
\item \code{ThreeSubj_family_idx_lst}: List of family indices into CLT cache for 3+ member families (ntaus elements).
\item \code{ThreeSubj_stand_S_lst}: List of standardized score arrays for 3+ member families (ntaus elements).
\item \code{MAF_interval}: Numeric vector of MAF breakpoints used for genotype approximation.
\item \code{Call}: Original function call.
\item \code{sessionInfo}: R session and package information.
\item \code{time}: Analysis completion timestamp (character).
\item \code{control}: List of control parameters used in fitting.
}

\strong{Output file columns from \code{GRAB.Marker()}:}
\describe{
\item{Marker}{Marker identifier (rsID or CHR:POS:REF:ALT).}
\item{Info}{Marker information in format CHR:POS:REF:ALT.}
\item{AltFreq}{Alternative allele frequency in the sample.}
\item{AltCounts}{Total count of alternative alleles (integer).}
\item{MissingRate}{Proportion of missing genotypes.}
\item{hwepval}{Hardy-Weinberg equilibrium p-value.}
\item{Z_tau\link{tau}}{Z-score from score test at quantile \link{tau} (one column per tau).}
\item{P_tau\link{tau}}{P-value from score test at quantile \link{tau} (one column per tau).}
\item{P_CCT}{Cauchy combination test p-value aggregating across all quantiles.}
}
}
\examples{
# Step 1: Fit null model and prepare genotype distribution cache
# See ?getSparseGRM for details on generating a sparse GRM.
# See ?getPairwiseIBD for details on computing pairwise IBD estimates.

SparseGRMFile <- system.file("extdata", "SparseGRM.txt", package = "GRAB")
PairwiseIBDFile <- system.file("extdata", "PairwiseIBD.txt", package = "GRAB")

PhenoFile <- system.file("extdata", "simuPHENO.txt", package = "GRAB")
PhenoData <- data.table::fread(PhenoFile, header = TRUE)

GenoFile <- system.file("extdata", "simuPLINK.bed", package = "GRAB")
OutputFile <- file.path(tempdir(), "resultSPAsqr.txt")

obj.SPAsqr <- GRAB.NullModel(
  QuantPheno ~ AGE + GENDER,
  data = PhenoData,
  subjIDcol = "IID",
  method = "SPAsqr",
  traitType = "quantitative",
  SparseGRMFile = SparseGRMFile,
  control = list(taus = c(0.2, 0.5, 0.8)),
  PairwiseIBDFile = PairwiseIBDFile
)

# Step 2: Perform single-marker association tests
GRAB.Marker(obj.SPAsqr, GenoFile, OutputFile)

# View results
head(data.table::fread(OutputFile))

}
\references{
Heng et al. (in prep). Discovering Heterogeneous Associations with Smoothed Quantile Regression and Saddle Point Approximation.

Xu et al. (2025). SPAGRM: effectively controlling for sample relatedness in large-scale
genome-wide association studies of longitudinal traits. Nature Communications, 16:1018.

Liu, Yaowu and Jun Xie (2020). Cauchy combination test: a powerful test with analytic p-value
calculation under arbitrary dependency structures. Journal of the American Statistical
Association, 115.529:393-402.
}
