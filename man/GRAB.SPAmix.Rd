% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/SPAmix.R
\name{GRAB.SPAmix}
\alias{GRAB.SPAmix}
\title{SPAmix method in GRAB package}
\usage{
GRAB.SPAmix()
}
\value{
No return value, called for side effects (prints information about the SPAmix method to the console).
}
\description{
SPAmix method is an empirical approach to analyzing complex traits
(including but not limited to time-to-event trait) for unrelated samples
in a large-scale biobank. SPAmix extends SPACox to support an admixture
population or multiple populations.
}
\details{
For SPAmix, the confounding factors of SNP-derived PCs are required and should be specified in \code{control}.

\strong{Additional Control Parameters for GRAB.NullModel()}:
\itemize{
\item \code{PC_columns} (character, required): Comma-separated column names of principal components (e.g., "PC1,PC2").
\item \code{OutlierRatio} (numeric, default: 1.5): IQR multiplier for outlier detection. Outliers are defined as values outside [Q1 - r\emph{IQR, Q3 + r}IQR].
}

\strong{Additional Control Parameters for GRAB.Marker()}:
\itemize{
\item \code{SPA_Cutoff} (numeric, default: 2): Cutoff for saddlepoint approximation.
\item \code{dosage_option} (character, default: "rounding_first"): Dosage handling option. Must be either "rounding_first" or "rounding_last".
}
}
\examples{
# Step 1: fit a null model
PhenoFile <- system.file("extdata", "simuPHENO.txt", package = "GRAB")
PhenoData <- data.table::fread(PhenoFile, header = TRUE)

# Users can directly specify a time-to-event trait to analyze
obj.SPAmix <- GRAB.NullModel(
  survival::Surv(SurvTime, SurvEvent) ~ AGE + GENDER + PC1 + PC2,
  data = PhenoData,
  subjIDcol = "IID",
  method = "SPAmix",
  traitType = "time-to-event",
  control = list(PC_columns = "PC1,PC2")
)

# Using model residuals performs exactly the same as the above. Note that
# confounding factors are still required in the right of the formula.
obj.coxph <- survival::coxph(
  survival::Surv(SurvTime, SurvEvent) ~ AGE + GENDER + PC1 + PC2,
  data = PhenoData
)

obj.SPAmix <- GRAB.NullModel(
  obj.coxph$residuals ~ AGE + GENDER + PC1 + PC2,
  data = PhenoData,
  subjIDcol = "IID",
  method = "SPAmix",
  traitType = "Residual",
  control = list(PC_columns = "PC1,PC2")
)

# SPAmix also supports multiple residuals as below
obj.coxph <- survival::coxph(
  survival::Surv(SurvTime, SurvEvent) ~ AGE + GENDER + PC1 + PC2,
  data = PhenoData
)
obj.lm <- lm(QuantPheno ~ AGE + GENDER + PC1 + PC2, data = PhenoData)

obj.SPAmix <- GRAB.NullModel(
  obj.coxph$residuals + obj.lm$residuals ~ AGE + GENDER + PC1 + PC2,
  data = PhenoData,
  subjIDcol = "IID",
  method = "SPAmix",
  traitType = "Residual",
  control = list(PC_columns = "PC1,PC2")
)

# Step 2: conduct score test
GenoFile <- system.file("extdata", "simuPLINK.bed", package = "GRAB")
OutputDir <- tempdir()
OutputFile <- file.path(OutputDir, "resultSPAmix.txt")
GRAB.Marker(obj.SPAmix, GenoFile, OutputFile)
data.table::fread(OutputFile)

}
